# GUL v3.2 Test Runner
# Automated testing with @ prefix types

@imp std.test
@imp std.io

struct TestSuite:
    name: @str
    tests: @list
    passed: @int
    failed: @int
    
    fn add_test(mut self, test_name, test_fn):
        self.tests.append(@dict{name: test_name, fn: test_fn})
    
    fn @dict run(mut self):
        print("Running test suite:", self.name)
        
        for test in self.tests:
            try:
                test["fn"]()
                self.passed = self.passed + 1
                print("  âœ“", test["name"])
            catch e:
                self.failed = self.failed + 1
                print("  âœ—", test["name"], "-", e)
        
        return @dict{
            total: self.tests.length(),
            passed: self.passed,
            failed: self.failed
        }

fn test_primitives():
    assert(@int(42) == 42, "int test")
    assert(@str("hello") == "hello", "str test")
    assert(@bool(true) == true, "bool test")

fn test_collections():
    let list = @list[1, 2, 3]
    assert(list.length() == 3, "list length")
    
    let dict = @dict{key: "value"}
    assert(dict["key"] == "value", "dict access")

fn test_functions():
    fn @int add(a, b): a + b
    assert(add(2, 3) == 5, "function test")

mn:
    print("=== GUL v3.2 Test Runner ===")
    
    var suite = TestSuite{
        name: "Core Tests",
        tests: @list[],
        passed: 0,
        failed: 0
    }
    
    suite.add_test("Primitives", test_primitives)
    suite.add_test("Collections", test_collections)
    suite.add_test("Functions", test_functions)
    
    let results = suite.run()
    
    print("\nResults:")
    print("  Total:", results["total"])
    print("  Passed:", results["passed"])
    print("  Failed:", results["failed"])
